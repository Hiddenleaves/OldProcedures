CREATE OR REPLACE PROCEDURE SP_XXXXXXXXXXXX IS

BEGIN

  update inv_stor ttt
     set aux2 = 'XZZZZZZZZZZZZZZZZZZZ'
   where ttt.inv_stor_id in (select inv_stor_id
                               from inv_stor
                              where Sys_office_code in ('WJ1', 'ZS1')
                                and status <> 'PICK'
                                and aux2 is null);

  commit;

  for i in 1 .. 500 loop

    update inv_stor ttt
       set ttt.aux2 = (select ggg.bpp_code
                         from ((select m.*, n.bpp_code, n.bpp_name
                                  from (select a.inv_stor_id,
                                               a.sys_office_code,
                                               a.sys_office_name,
                                               a.item_code,
                                               a.item_name,
                                               a.lm_code,
                                               a.batch,
                                               a.qty,
                                               case
                                                 when a.lm_code like '2-%' then
                                                  substr(a.lm_code, 3, 10)
                                                 when a.lm_code like '1-%' and
                                                      length(a.lm_code) = '15' then
                                                  substr(a.lm_code, 3, 7)
                                                 when a.lm_code like '1-%' and
                                                      length(a.lm_code) = '16' then
                                                  substr(a.lm_code, 3, 8)
                                               end as ext_po
                                          from inv_stor a
                                         where a.sys_office_code in
                                               ('WJ1', 'ZS1')
                                           and status <> 'PICK'
                                           and lpn_code = 'CASE'
                                           and aux2 = 'XZZZZZZZZZZZZZZZZZZZ') m
                                  left join po_order n on m.ext_po = n.ext_po
                                union
                                select a.inv_stor_id,
                                       a.sys_office_code,
                                       a.sys_office_name,
                                       a.item_code,
                                       a.item_name,
                                       a.lm_code,
                                       a.batch,
                                       a.qty,
                                       case
                                         when c.ext_po like '%ZD%' then
                                          null
                                         else
                                          c.ext_po
                                       end as ext_po,
                                       c.bpp_code,
                                       c.bpp_name
                                  from inv_stor a
                                  left join inbound_order b on a.bill_id =
                                                               b.inbound_order_id
                                  left join po_order c on c.ext_po =
                                                          b.ext_inbound1
                                 where a.sys_office_code in ('WJ1', 'ZS1')
                                   and status <> 'PICK'
                                   and lpn_code = 'ODD'
                                   and aux2 = 'XZZZZZZZZZZZZZZZZZZZ')) ggg
                        where ttt.inv_stor_id = ggg.inv_stor_id)
     where ttt.aux2 = 'XZZZZZZZZZZZZZZZZZZZ'
       and rownum <= 100;

    /*
      delete from barcode_list
       where bill_id =
             (select po_order_id from po_order where ext_po = '4501898587')
         and rownum < i * 10000;
    */

    commit;

  end loop;

END SP_XXXXXXXXXXXX;
